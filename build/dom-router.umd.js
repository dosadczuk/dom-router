(function(h){typeof define=="function"&&define.amd?define(h):h()})(function(){"use strict";const h=e=>typeof e=="string",f=e=>e==null||h(e)&&e.length===0,V=(e,t)=>Object.values(e).includes(t),C=e=>e instanceof HTMLTemplateElement,z=e=>e instanceof HTMLAnchorElement;var i;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.TitleDefault="data-router-title-default",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page",e.PageFallback="data-router-page-fallback",e.Sitemap="data-router-sitemap",e.SitemapIgnore="data-router-sitemap-ignore"})(i||(i={}));var l;(function(e){e.PageChange="page-change",e.ViewChange="view-change"})(l||(l={}));var m;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.PageChanged="router:page-changed",e.ViewChanged="router:view-changed"})(m||(m={}));var g;(function(e){e.Display="display",e.Template="template"})(g||(g={}));const v=document.documentElement,L=e=>{var t;return(t=v.getAttribute(e))!=null?t:null},F=e=>e.map(L),W=e=>v.hasAttribute(e),A=e=>{v.removeAttribute(e)},M=e=>{e.forEach(A)},H=()=>{const e=v.querySelectorAll(G());return e.length===0?[]:Array.from(e,t=>{const n=Array.from(t.attributes),o=new Map;for(const{name:r,value:a}of n)B(r)&&o.set(r,a);return{content:t,visible:!1,directives:o}})},k=(e,t)=>e.filter(n=>n.directives.has(t)),I=(e,t)=>{var n;return(n=e.find(o=>o.directives.has(t)))!=null?n:null},N=(e,t)=>{e.forEach(({content:n})=>n.removeAttribute(t))},T=e=>(t,n)=>{switch(e){case g.Display:return n?x(t):U(t);case g.Template:return n?$(t):O(t)}return!1},x=e=>(e.content.style.display="revert",e.visible=!0,!0),U=e=>(e.content.style.display="none",e.visible=!1,!1),$=e=>{const{content:t}=e;if(!C(t))return!0;const n=t.content.firstElementChild;return n==null?!1:(e.content.replaceWith(n),e.content=n,e.visible=!0,!0)},O=e=>{const{content:t}=e;if(C(t))return!1;const n=document.createElement("template");return n.content.append(t.cloneNode(!0)),e.content.replaceWith(n),e.content=n,e.visible=!1,!1},_=(e,t)=>{e.content.classList.add(...t)},j=(e,t)=>{e.content.classList.remove(...t)},P=new Map,u=(e,t)=>{P.set(e,t!=null?t:null)},q=(e,t)=>{for(const n of t){const o=P.get(n);if(o==null)continue;const{factory:r,options:a}=o;if(r!=null){const s=r(e,k(e,n),a);s!=null&&s()}a!=null&&a.removable&&N(e,n)}},B=e=>R().includes(e),R=()=>Array.from(P.keys()),G=()=>R().map(e=>`[${e}]`).join(", "),d=new Map,b=(e,t)=>(d.has(e)||d.set(e,new Set),d.get(e).add(t),()=>{d.has(e)&&d.get(e).delete(t)}),E=(e,t)=>{var n;(n=d.get(e))==null||n.forEach(o=>o(t))},J=(e,t,n)=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}),y=(e,t,n)=>{e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))},K=e=>t=>{t.preventDefault(),e(t)};function Q(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,o,r,a,s=[],c="",p=e.split("/");for(p[0]||p.shift();r=p.shift();)n=r[0],n==="*"?(s.push("wild"),c+="/(.*)"):n===":"?(o=r.indexOf("?",1),a=r.indexOf(".",1),s.push(r.substring(1,~o?o:~a?a:r.length)),c+=!!~o&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(c+=(~o?"?":"")+"\\"+r.substring(a))):c+="/"+r;return{keys:s,pattern:new RegExp("^"+c+(t?"(?=$|/)":"/?$"),"i")}}const S=()=>new URL(window.location.href),w=(e,t=S())=>Q(e).pattern.test(t.pathname);u(i.Init,{factory:()=>{var t;let e=(t=L(i.Init))!=null?t:"";V(g,e)||(e=g.Display),y(document,m.Initialize),b(l.PageChange,n=>{w(n,S())||(history.pushState(null,"",n),y(document,m.PageChanged,n),E(l.ViewChange,T(e)))}),J(window,"popstate",()=>{E(l.ViewChange,T(e))}),E(l.ViewChange,T(e)),A(i.Init),y(document,m.Initialized)}}),u(i.Cloak,{factory:null,options:{removable:!0}}),u(i.Link,{factory:(e,t)=>{for(const n of t){const o=D(n);f(o)||n.content.addEventListener("click",K(()=>{E(l.PageChange,o)}))}},options:{removable:!0}});const D=({content:e,directives:t})=>{var o;const n=t.get(i.Link);return f(n)?z(e)&&(o=e.pathname)!=null?o:null:n};u(i.LinkActive,{factory:(e,t)=>{b(l.ViewChange,()=>{for(const n of t){const o=D(n);if(f(o))continue;let r=n.directives.get(i.LinkActive);f(r)&&(r="active"),w(o)?_(n,r.split(" ")):j(n,r.split(" "))}})},options:{removable:!0}}),u(i.Page,{factory:(e,t)=>{const n=X(t);if(n.size===0)return;const o=I(t,i.PageFallback);b(l.ViewChange,r=>{const a={page:null,route:null};for(const[s,c]of n.entries())r(c,w(s))&&(a.page=c.content,a.route=s);a.page==null&&o!=null&&r(o,!0)&&(a.page=o.content),y(document,m.ViewChanged,a)})},options:{removable:!0}});const X=e=>{const t=new Map;for(const n of e){const o=n.directives.get(i.Page);f(o)||t.set(o,n)}return t};u(i.PageFallback,{factory:null,options:{removable:!0}}),u(i.Sitemap,{factory:e=>{const t=I(e,i.Sitemap);if(t==null)return;const n=k(e,i.Page);if(n.length===0)return;const o=document.createElement("ol");for(const{directives:r}of n){if(r.has(i.SitemapIgnore))continue;const a=r.get(i.Page),s=r.get(i.Title);if(f(a)||f(s))continue;const c=document.createElement("a");c.href=a,c.text=s;const p=document.createElement("li");p.append(c),o.append(p)}t.content.append(o)},options:{removable:!1}}),u(i.SitemapIgnore,{factory:null,options:{removable:!0}}),u(i.Title,{factory:e=>{const t=k(e,i.Page);if(t.length===0)return;const[n,o]=F([i.Title,i.TitleDefault]);return b(l.ViewChange,()=>{var r;for(const a of t){const s=a.directives.get(i.Page),c=(r=a.directives.get(i.Title))!=null?r:o;if(!(f(s)||f(c))&&w(s)){n!=null?document.title=n.replace("{title}",c):document.title=c;break}}}),()=>{M([i.Title,i.TitleDefault])}},options:{removable:!0}}),u(i.TitleDefault,{factory:null,options:{removable:!0}}),(()=>{if(!W(i.Init))throw new Error(`Router cannot be initialized. Add '${i.Init}' attribute to <html></html> tag.`);const t=H();if(t.length===0)throw new Error("Router cannot be initialized. No directive found.");q(t,[i.Cloak,i.Title,i.TitleDefault,i.Page,i.PageFallback,i.Sitemap,i.SitemapIgnore,i.Link,i.LinkActive,i.Init])})()});
