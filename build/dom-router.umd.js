(function(d){typeof define=="function"&&define.amd?define(d):d()})(function(){"use strict";const d=new Map,m=(e,t)=>{d.set(e,t)},S=(e,t)=>{for(const n of t){const r=d.get(n);r!=null&&r(e)}},W=e=>P().includes(e),P=()=>Array.from(d.keys()),M=()=>P().map(e=>`[${e}]`).join(", "),F=e=>typeof e=="string",g=e=>e==null||F(e)&&e.length===0,V=(e,t)=>Object.values(e).includes(t),y=e=>e instanceof HTMLTemplateElement,z=e=>e instanceof HTMLAnchorElement;var i;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page",e.PageFallback="data-router-page-fallback",e.Sitemap="data-router-sitemap",e.SitemapIgnore="data-router-sitemap-ignore"})(i||(i={}));var l;(function(e){e.PageChange="page-change",e.ViewChange="view-change"})(l||(l={}));var E;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.ViewChanged="router:view-changed"})(E||(E={}));var p;(function(e){e.Display="display",e.Template="template"})(p||(p={}));const R=()=>{const e=document.querySelectorAll(M());return e.length===0?[]:Array.from(e,t=>{const n=Array.from(t.attributes),r=new Map;for(const{name:o,value:a}of n)W(o)&&r.set(o,a);return{content:t,directives:r}})},u=(e,t)=>e.filter(n=>n.directives.has(t)),C=(e,t)=>{var n;return(n=u(e,t)[0])!=null?n:null},f=(e,t)=>{e.forEach(({content:n})=>n.removeAttribute(t))},L=e=>(t,n)=>{switch(e){case p.Display:return H(t,n);case p.Template:return N(t,n)}return!1},H=(e,t)=>t?D(e):x(e),D=({content:e})=>(e.style.display="revert",!0),x=({content:e})=>(e.style.display="none",!1),N=(e,t)=>t?U(e):$(e),U=e=>{const{content:t}=e;if(!y(t))return!0;const n=t.content.firstElementChild;return n==null?!1:(e.content.replaceWith(n),e.content=n,!0)},$=e=>{const{content:t}=e;if(y(t))return!1;const n=document.createElement("template");return n.content.append(t.cloneNode(!0)),e.content.replaceWith(n),e.content=n,!1},O=(e,t)=>{e.content.classList.add(...t)},j=(e,t)=>{e.content.classList.remove(...t)},h=new Map,v=(e,t)=>(h.has(e)||h.set(e,new Set),h.get(e).add(t),()=>{h.has(e)&&h.get(e).delete(t)}),b=(e,t)=>{var n;(n=h.get(e))==null||n.forEach(r=>r(t))},q=(e,t,n)=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}),T=(e,t,n)=>{e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))},B=e=>t=>{t.preventDefault(),e(t)};function G(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,r,o,a,s=[],c="",k=e.split("/");for(k[0]||k.shift();o=k.shift();)n=o[0],n==="*"?(s.push("wild"),c+="/(.*)"):n===":"?(r=o.indexOf("?",1),a=o.indexOf(".",1),s.push(o.substring(1,~r?r:~a?a:o.length)),c+=!!~r&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(c+=(~r?"?":"")+"\\"+o.substring(a))):c+="/"+o;return{keys:s,pattern:new RegExp("^"+c+(t?"(?=$|/)":"/?$"),"i")}}const A=()=>new URL(window.location.href),w=(e,t=A())=>G(e).pattern.test(t.pathname);m(i.Init,()=>{let e=document.documentElement.getAttribute(i.Init);V(p,e)||(e=p.Display),T(document,E.Initialize),v(l.PageChange,t=>{w(t,A())||(history.pushState(null,"",t),b(l.ViewChange,L(e)))}),q(window,"popstate",()=>{b(l.ViewChange,L(e))}),b(l.ViewChange,L(e)),document.documentElement.removeAttribute(i.Init),T(document,E.Initialized)}),m(i.Cloak,e=>{const t=u(e,i.Cloak);t.length!==0&&f(t,i.Cloak)}),m(i.Link,e=>{const t=u(e,i.Link);if(t.length!==0){for(const n of t){const r=I(n);r!=null&&n.content.addEventListener("click",B(()=>{b(l.PageChange,r)}))}f(t,i.Link)}});const I=({content:e,directives:t})=>{var r;const n=t.get(i.Link);return g(n)?z(e)&&(r=e.pathname)!=null?r:null:n};m(i.LinkActive,e=>{const t=u(e,i.LinkActive);t.length!==0&&(v(l.ViewChange,()=>{for(const n of t){const r=I(n);if(g(r))continue;let o=n.directives.get(i.LinkActive);g(o)&&(o="active"),w(r)?O(n,o.split(" ")):j(n,o.split(" "))}}),f(t,i.LinkActive))}),m(i.Page,e=>{const t=u(e,i.Page);if(t.length===0)return;const n=C(t,i.PageFallback);v(l.ViewChange,r=>{let o=!1;for(const a of t){const s=a.directives.get(i.Page);if(g(s))continue;const c=r(a,w(s));o||(o=c)}!o&&n!=null&&r(n,!0),T(document,E.ViewChanged)}),f(t,i.Page)}),m(i.PageFallback,e=>{const t=u(e,i.PageFallback);t.length!==0&&f(t,i.PageFallback)}),m(i.Sitemap,e=>{const t=C(e,i.Sitemap);if(t==null)return;const n=u(e,i.Page);if(n.length===0)return;const r=document.createElement("ol");for(const{directives:o}of n){if(o.has(i.SitemapIgnore))continue;const a=o.get(i.Page),s=o.get(i.Title);if(g(a)||g(s))continue;const c=document.createElement("a");c.href=a,c.text=s;const k=document.createElement("li");k.append(c),r.append(k)}t.content.append(r)}),m(i.SitemapIgnore,e=>{const t=u(e,i.SitemapIgnore);t.length!==0&&f(t,i.SitemapIgnore)}),m(i.Title,e=>{const t=u(e,i.Title);if(t.length===0)return;const n=u(t,i.Page);if(n.length===0)return;const r=document.documentElement.getAttribute(i.Title);v(l.ViewChange,()=>{for(const o of n){const a=o.directives.get(i.Page),s=o.directives.get(i.Title);if(!(g(a)||g(s))&&w(a)){r!=null?document.title=r.replace("{title}",s):document.title=s;break}}}),f(t,i.Title)}),(()=>{if(!document.documentElement.hasAttribute(i.Init))throw new Error(`Router cannot be initialized. Add '${i.Init}' attribute to <html></html> tag.`);const t=R();if(t.length===0)throw new Error("Router cannot be initialized. No directive found.");S(t,[i.Cloak,i.Title,i.Page,i.PageFallback,i.Sitemap,i.SitemapIgnore,i.Link,i.LinkActive,i.Init])})()});
