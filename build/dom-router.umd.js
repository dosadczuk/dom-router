(function(d){typeof define=="function"&&define.amd?define(d):d()})(function(){"use strict";const d=new Map,s=(e,t)=>{d.set(e,t)},S=(e,t)=>{for(const i of t){const r=d.get(i);r!=null&&r(e)}},W=e=>P().includes(e),P=()=>Array.from(d.keys()),D=()=>P().map(e=>`[${e}]`).join(", "),F=e=>typeof e=="string",f=e=>e==null||F(e)&&e.length===0,M=(e,t)=>Object.values(e).includes(t),y=e=>e instanceof HTMLTemplateElement,V=e=>e instanceof HTMLAnchorElement;var n;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.TitleDefault="data-router-title-default",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page",e.PageFallback="data-router-page-fallback",e.Sitemap="data-router-sitemap",e.SitemapIgnore="data-router-sitemap-ignore"})(n||(n={}));var u;(function(e){e.PageChange="page-change",e.ViewChange="view-change"})(u||(u={}));var E;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.ViewChanged="router:view-changed"})(E||(E={}));var p;(function(e){e.Display="display",e.Template="template"})(p||(p={}));const z=()=>{const e=document.querySelectorAll(D());return e.length===0?[]:Array.from(e,t=>{const i=Array.from(t.attributes),r=new Map;for(const{name:a,value:o}of i)W(a)&&r.set(a,o);return{content:t,directives:r}})},m=(e,t)=>e.filter(i=>i.directives.has(t)),C=(e,t)=>{var i;return(i=m(e,t)[0])!=null?i:null},g=(e,t)=>{e.forEach(({content:i})=>i.removeAttribute(t))},w=e=>(t,i)=>{switch(e){case p.Display:return R(t,i);case p.Template:return N(t,i)}return!1},R=(e,t)=>t?H(e):x(e),H=({content:e})=>(e.style.display="revert",!0),x=({content:e})=>(e.style.display="none",!1),N=(e,t)=>t?U(e):$(e),U=e=>{const{content:t}=e;if(!y(t))return!0;const i=t.content.firstElementChild;return i==null?!1:(e.content.replaceWith(i),e.content=i,!0)},$=e=>{const{content:t}=e;if(y(t))return!1;const i=document.createElement("template");return i.content.append(t.cloneNode(!0)),e.content.replaceWith(i),e.content=i,!1},O=(e,t)=>{e.content.classList.add(...t)},j=(e,t)=>{e.content.classList.remove(...t)},h=new Map,v=(e,t)=>(h.has(e)||h.set(e,new Set),h.get(e).add(t),()=>{h.has(e)&&h.get(e).delete(t)}),b=(e,t)=>{var i;(i=h.get(e))==null||i.forEach(r=>r(t))},q=(e,t,i)=>(e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}),L=(e,t,i)=>{e.dispatchEvent(new CustomEvent(t,{detail:i,bubbles:!0,composed:!0,cancelable:!0}))},B=e=>t=>{t.preventDefault(),e(t)};function G(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var i,r,a,o,c=[],l="",k=e.split("/");for(k[0]||k.shift();a=k.shift();)i=a[0],i==="*"?(c.push("wild"),l+="/(.*)"):i===":"?(r=a.indexOf("?",1),o=a.indexOf(".",1),c.push(a.substring(1,~r?r:~o?o:a.length)),l+=!!~r&&!~o?"(?:/([^/]+?))?":"/([^/]+?)",~o&&(l+=(~r?"?":"")+"\\"+a.substring(o))):l+="/"+a;return{keys:c,pattern:new RegExp("^"+l+(t?"(?=$|/)":"/?$"),"i")}}const A=()=>new URL(window.location.href),T=(e,t=A())=>G(e).pattern.test(t.pathname);s(n.Init,()=>{let e=document.documentElement.getAttribute(n.Init);M(p,e)||(e=p.Display),L(document,E.Initialize),v(u.PageChange,t=>{T(t,A())||(history.pushState(null,"",t),b(u.ViewChange,w(e)))}),q(window,"popstate",()=>{b(u.ViewChange,w(e))}),b(u.ViewChange,w(e)),document.documentElement.removeAttribute(n.Init),L(document,E.Initialized)}),s(n.Cloak,e=>{const t=m(e,n.Cloak);t.length!==0&&g(t,n.Cloak)}),s(n.Link,e=>{const t=m(e,n.Link);if(t.length!==0){for(const i of t){const r=I(i);r!=null&&i.content.addEventListener("click",B(()=>{b(u.PageChange,r)}))}g(t,n.Link)}});const I=({content:e,directives:t})=>{var r;const i=t.get(n.Link);return f(i)?V(e)&&(r=e.pathname)!=null?r:null:i};s(n.LinkActive,e=>{const t=m(e,n.LinkActive);t.length!==0&&(v(u.ViewChange,()=>{for(const i of t){const r=I(i);if(f(r))continue;let a=i.directives.get(n.LinkActive);f(a)&&(a="active"),T(r)?O(i,a.split(" ")):j(i,a.split(" "))}}),g(t,n.LinkActive))}),s(n.Page,e=>{const t=m(e,n.Page);if(t.length===0)return;const i=C(t,n.PageFallback);v(u.ViewChange,r=>{let a=!1;for(const o of t){const c=o.directives.get(n.Page);if(f(c))continue;const l=r(o,T(c));a||(a=l)}!a&&i!=null&&r(i,!0),L(document,E.ViewChanged)}),g(t,n.Page)}),s(n.PageFallback,e=>{const t=m(e,n.PageFallback);t.length!==0&&g(t,n.PageFallback)}),s(n.Sitemap,e=>{const t=C(e,n.Sitemap);if(t==null)return;const i=m(e,n.Page);if(i.length===0)return;const r=document.createElement("ol");for(const{directives:a}of i){if(a.has(n.SitemapIgnore))continue;const o=a.get(n.Page),c=a.get(n.Title);if(f(o)||f(c))continue;const l=document.createElement("a");l.href=o,l.text=c;const k=document.createElement("li");k.append(l),r.append(k)}t.content.append(r)}),s(n.SitemapIgnore,e=>{const t=m(e,n.SitemapIgnore);t.length!==0&&g(t,n.SitemapIgnore)}),s(n.Title,e=>{const t=m(e,n.Page);if(t.length===0)return;const i=document.documentElement.getAttribute(n.Title),r=document.documentElement.getAttribute(n.TitleDefault);v(u.ViewChange,()=>{var a;for(const o of t){const c=o.directives.get(n.Page);if(f(c))continue;const l=(a=o.directives.get(n.Title))!=null?a:r;if(!f(l)&&T(c)){i!=null?document.title=i.replace("{title}",l):document.title=l;break}}}),g(t,n.Title)}),s(n.TitleDefault,e=>{const t=m(e,n.TitleDefault);t.length!==0&&g(t,n.TitleDefault)}),(()=>{if(!document.documentElement.hasAttribute(n.Init))throw new Error(`Router cannot be initialized. Add '${n.Init}' attribute to <html></html> tag.`);const t=z();if(t.length===0)throw new Error("Router cannot be initialized. No directive found.");S(t,[n.Cloak,n.Title,n.TitleDefault,n.Page,n.PageFallback,n.Sitemap,n.SitemapIgnore,n.Link,n.LinkActive,n.Init])})()});
