(function(b){typeof define=="function"&&define.amd?define(b):b()})(function(){"use strict";const b=e=>typeof e=="string"||e instanceof String,p=e=>e==null||b(e)&&e.length===0,R=(e,t)=>Object.values(t).includes(String(e)),U=e=>R(e,o)&&M().includes(e),I=e=>e instanceof HTMLAnchorElement,z=e=>e instanceof HTMLTemplateElement;var m;(function(e){e.Display="display",e.Template="template"})(m||(m={}));let v=document.documentElement;const A=(e,t)=>{var n;return(n=v.getAttribute(String(e)))!=null?n:t},F=e=>e.map(t=>A(t)),B=e=>v.hasAttribute(String(e)),H=e=>{v.removeAttribute(String(e))},W=e=>{e.forEach(t=>H(t))},N=()=>{const e=v.querySelectorAll(Q());return e.length===0?[]:Array.from(e,t=>{const n=Array.from(t.attributes),r=new Map;for(const{name:i,value:a}of n)U(i)&&r.set(i,a);return{element:t,visible:!1,directives:r}})},D=(e,t)=>{var n;return(n=e.find(r=>r.directives.has(t)))!=null?n:null},$=(e,t)=>{e.forEach(({element:n})=>{n.removeAttribute(t)})},S=e=>(t,n)=>{switch(e){case m.Display:t.visible=n?O(t):j(t);break;case m.Template:t.visible=n?x(t):q(t);break}return t.visible},O=e=>(e.element.style.display="revert",!0),j=e=>(e.element.style.display="none",!1),x=e=>{const{element:t}=e;if(!z(t))return!0;const n=t.content.firstElementChild;return n==null?!1:(e.element.replaceWith(n),e.element=n,!0)},q=e=>{const{element:t}=e;if(z(t))return!1;const n=document.createElement("template");return n.content.append(t.cloneNode(!0)),e.element.replaceWith(n),e.element=n,!1},G=(e,t)=>{e.element.classList.add(...t)},J=(e,t)=>{e.element.classList.remove(...t)};var o;(function(e){e.Initialize="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.TitleDefault="data-router-title-default",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page",e.PageFallback="data-router-page-fallback",e.Sitemap="data-router-sitemap",e.SitemapIgnore="data-router-sitemap-ignore"})(o||(o={}));const E=new Map,c=(e,t)=>{E.set(e,t!=null?t:null)},K=(e,t)=>{for(const n of t){const r=E.get(n);if(r==null)continue;const{factory:i,options:a}=r;if(i!=null){const s=i(e,a);s!=null&&s()}a!=null&&a.removable&&$(e,n)}},M=()=>Array.from(E.keys()),Q=()=>M().map(e=>`[${e}]`).join(", ");var u;(function(e){e[e.PageChange=0]="PageChange",e[e.ViewChange=1]="ViewChange"})(u||(u={}));var f;(function(e){e.BeforeMount="router:before-mount",e.Mounted="router:mounted",e.BeforePageUpdate="router:before-page-update",e.PageUpdated="router:page-updated",e.BeforeViewUpdate="router:before-view-update",e.ViewUpdated="router:view-updated"})(f||(f={}));const h=new Map,k=(e,t)=>(h.has(e)||h.set(e,new Set),h.get(e).add(t),()=>{h.get(e).delete(t)}),w=(e,t)=>{var n;(n=h.get(e))==null||n.forEach(r=>r(t))},X=(e,t,n)=>(e.addEventListener(String(t),n),()=>{e.removeEventListener(String(t),n)}),d=(e,t,n)=>{e.dispatchEvent(new CustomEvent(String(t),{detail:n,bubbles:!0,composed:!0,cancelable:!0}))},Y=e=>t=>{t.preventDefault(),t.stopPropagation(),e(t)};function Z(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,r,i,a,s=[],l="",g=e.split("/");for(g[0]||g.shift();i=g.shift();)n=i[0],n==="*"?(s.push("wild"),l+="/(.*)"):n===":"?(r=i.indexOf("?",1),a=i.indexOf(".",1),s.push(i.substring(1,~r?r:~a?a:i.length)),l+=!!~r&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(l+=(~r?"?":"")+"\\"+i.substring(a))):l+="/"+i;return{keys:s,pattern:new RegExp("^"+l+(t?"(?=$|/)":"/?$"),"i")}}const P=()=>new URL(window.location.href),y=(e,t=P())=>Z(e).pattern.test(t.pathname);c(o.Initialize,{factory:()=>{let e=A(o.Initialize,"");R(e,m)||(e=m.Display),d(document,f.BeforeMount),k(u.PageChange,t=>{y(t,P())||(d(document,f.BeforePageUpdate),history.pushState(null,"",t),d(document,f.PageUpdated),w(u.ViewChange,S(e)))}),X(window,"popstate",()=>{w(u.ViewChange,S(e))}),w(u.ViewChange,S(e)),d(document,f.Mounted)},options:{removable:!0}}),c(o.Cloak,{factory:null,options:{removable:!0}});const T=new Map,V=e=>{if(T.size>0)return T;for(const t of e){const n=_(t);p(n)||T.set(n,t)}return T},_=e=>{var r;const{element:t,directives:n}=e;return I(t)&&!p(t.href)?t.pathname:(r=n.get(o.Link))!=null?r:null};c(o.Link,{factory:e=>{const t=V(e);if(t.size!==0)for(const[n,r]of t)r.element.addEventListener("click",Y(()=>{w(u.PageChange,n)}))},options:{removable:!0}}),c(o.LinkActive,{factory:e=>{const t=V(e);t.size!==0&&k(u.ViewChange,()=>{for(const[n,r]of t){let i=r.directives.get(o.LinkActive);p(i)&&(i="active"),y(n)?G(r,i.split(" ")):J(r,i.split(" "))}})},options:{removable:!0}});const L=new Map,C=e=>{if(L.size>0)return L;for(const t of e){const n=t.directives.get(o.Page);p(n)||L.set(n,t)}return L};c(o.Page,{factory:e=>{const t=C(e);if(t.size===0)return;const n=D(e,o.PageFallback);k(u.ViewChange,r=>{const i={route:null,element:null};d(document,f.BeforeViewUpdate);for(const[a,s]of t)r(s,y(a))&&(i.route=a,i.element=s.element);i.element==null&&n!=null&&r(n,!0)&&(i.element=n.element),d(document,f.ViewUpdated,i)})},options:{removable:!0}}),c(o.PageFallback,{factory:null,options:{removable:!0}}),c(o.Sitemap,{factory:e=>{const t=D(e,o.Sitemap);if(t==null)return;const n=C(e);if(n.size===0)return;const r=document.createElement("ol");for(const[i,{directives:a}]of n){if(a.has(o.SitemapIgnore))continue;const s=a.get(o.Title);if(p(s))continue;const l=document.createElement("a");l.href=i,l.text=s;const g=document.createElement("li");g.append(l),r.append(g)}t.element.append(r)},options:{removable:!1}}),c(o.SitemapIgnore,{factory:null,options:{removable:!0}}),c(o.Title,{factory:e=>{const t=C(e);if(t.size===0)return;const[n,r]=F([o.Title,o.TitleDefault]);return k(u.ViewChange,()=>{var i;for(const[a,s]of t){if(!y(a,P()))continue;const l=(i=s.directives.get(o.Title))!=null?i:r;if(!p(l)){n!=null?document.title=n.replace("{{title}}",l):document.title=l;break}}}),()=>{W([o.Title,o.TitleDefault])}},options:{removable:!0}}),c(o.TitleDefault,{factory:null,options:{removable:!0}});const ee=[o.Cloak,o.TitleDefault,o.Title,o.PageFallback,o.Page,o.SitemapIgnore,o.Sitemap,o.LinkActive,o.Link,o.Initialize];(function(){if(!B(o.Initialize))throw new Error(`Router cannot be initialized. Add '${o.Initialize}' attribute to root element.`);const n=N();if(n.length===0)throw new Error("Router cannot be initialized. No directive found.");K(n,ee)})()});
