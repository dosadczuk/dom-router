(function(i){typeof define=="function"&&define.amd?define(i):i()})(function(){"use strict";var i;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page"})(i||(i={}));const k=new Map,l=(e,t)=>{k.set(e,t)},T=e=>{e.forEach(t=>A(t))},A=e=>{const t=k.get(e);t!=null&&t()},I=e=>V().includes(e),V=()=>Array.from(k.keys()),w=e=>P(e)?e.length==0:e==null,P=e=>typeof e=="string",W=(e,t)=>Object.values(e).includes(t),y=e=>e instanceof HTMLTemplateElement,z=e=>e instanceof HTMLAnchorElement;var c;(function(e){e.PageChange="page-change",e.ViewChange="view-change"})(c||(c={}));var f;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.ViewChanged="router:view-changed"})(f||(f={}));const a=new Map,h=(e,t)=>(a.has(e)||a.set(e,new Set),a.get(e).add(t),()=>{a.has(e)&&a.get(e).delete(t)}),E=(e,t)=>{var n;(n=a.get(e))==null||n.forEach(o=>{o(t)})},M=(e,t,n)=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}),L=(e,t,n)=>{e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))};var u;(function(e){e.Display="display",e.Template="template"})(u||(u={}));function D(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,o,s,r,g=[],p="",b=e.split("/");for(b[0]||b.shift();s=b.shift();)n=s[0],n==="*"?(g.push("wild"),p+="/(.*)"):n===":"?(o=s.indexOf("?",1),r=s.indexOf(".",1),g.push(s.substring(1,~o?o:~r?r:s.length)),p+=!!~o&&!~r?"(?:/([^/]+?))?":"/([^/]+?)",~r&&(p+=(~o?"?":"")+"\\"+s.substring(r))):p+="/"+s;return{keys:g,pattern:new RegExp("^"+p+(t?"(?=$|/)":"/?$"),"i")}}const m=()=>new URL(window.location.href),v=(e,t=m())=>D(e).pattern.test(t.pathname);l(i.Init,()=>{let e=document.documentElement.getAttribute(i.Init);W(u,e)||(e=u.Display),L(document,f.Initialize),h(c.PageChange,t=>{v(t,m())||(history.pushState(null,"",t),E(c.ViewChange,e))}),M(window,"popstate",()=>{E(c.ViewChange,e)}),E(c.ViewChange,e),L(document,f.Initialized)});const d=e=>{const t=document.querySelectorAll(`[${e}]`);return t.length===0?[]:Array.from(t,n=>{const o=Array.from(n.attributes),s=new Map;for(const{name:r,value:g}of o)I(r)&&s.set(r,g);return{content:n,directives:s}})},R=(e,t)=>{t?H(e):N(e)},H=({content:e})=>{e.style.display="revert"},N=({content:e})=>{e.style.display="none"},S=(e,t)=>{t?U(e):x(e)},U=e=>{const{content:t}=e;if(!y(t))return;const n=t.content.firstElementChild;n!=null&&(e.content.replaceWith(n),e.content=n)},x=e=>{const{content:t,directives:n}=e;if(y(t))return;const o=document.createElement("template");o.content.append(t.cloneNode(!0)),n.forEach((s,r)=>{o.setAttribute(r,s)}),e.content.replaceWith(o),e.content=o},$=(e,t)=>{e.content.classList.add(...t)},O=(e,t)=>{e.content.classList.remove(...t)};l(i.Cloak,()=>{const e=d(i.Cloak);if(e.length!==0)for(const t of e)t.content.removeAttribute(i.Cloak)}),l(i.Link,()=>{const e=d(i.Link);if(e.length!==0)for(const t of e){const n=C(t);n!=null&&t.content.addEventListener("click",o=>{o.preventDefault(),E(c.PageChange,n)})}});const C=({content:e,directives:t})=>{var o;const n=t.get(i.Link);return n!=null&&!w(n)?n:z(e)&&(o=e.pathname)!=null?o:null};l(i.LinkActive,()=>{const e=d(i.LinkActive);e.length!==0&&h(c.ViewChange,()=>{const t=m();for(const n of e){const o=C(n);if(o==null)continue;let s=n.directives.get(i.LinkActive);(s==null||w(s))&&(s="active");const r=s.split(" ");v(o,t)?$(n,r):O(n,r)}})}),l(i.Page,()=>{const e=d(i.Page);e.length!==0&&h(c.ViewChange,t=>{const n=m();for(const o of e){const s=o.directives.get(i.Page);if(s==null||w(s))continue;const r=v(s,n);switch(t){case u.Display:R(o,r);break;case u.Template:S(o,r);break}}L(document,f.ViewChanged)})}),l(i.Title,()=>{const e=d(i.Title);if(e.length===0)return;const t=document.documentElement.getAttribute(i.Title);h(c.ViewChange,()=>{const n=m();for(const o of e){const s=o.directives.get(i.Page),r=o.directives.get(i.Title);if(!(s==null||r==null)&&v(s,n)){t!=null?document.title=t.replace("{title}",r):document.title=r;break}}})}),(()=>{if(!document.documentElement.hasAttribute(i.Init))return console.warn(`Router cannot be initialized. Add '${i.Init}' attribute to <html></html> tag.`);T([i.Cloak,i.Title,i.Page,i.Link,i.LinkActive,i.Init])})()});
