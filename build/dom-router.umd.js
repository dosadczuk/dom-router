(function(l){typeof define=="function"&&define.amd?define(l):l()})(function(){"use strict";const l=new Map,u=(e,t)=>{l.set(e,t)},I=(e,t)=>{for(const n of t){const o=l.get(n);o!=null&&o(e)}},P=e=>y().includes(e),y=()=>Array.from(l.keys()),W=()=>y().map(e=>`[${e}]`).join(", "),M=e=>typeof e=="string",m=e=>e==null||M(e)&&e.length===0,z=(e,t)=>Object.values(e).includes(t),C=e=>e instanceof HTMLTemplateElement,R=e=>e instanceof HTMLAnchorElement;var i;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page"})(i||(i={}));var c;(function(e){e.PageChange="page-change",e.ViewChange="view-change"})(c||(c={}));var h;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.ViewChanged="router:view-changed"})(h||(h={}));var f;(function(e){e.Display="display",e.Template="template"})(f||(f={}));const d=new Map,w=(e,t)=>(d.has(e)||d.set(e,new Set),d.get(e).add(t),()=>{d.has(e)&&d.get(e).delete(t)}),L=(e,t)=>{var n;(n=d.get(e))==null||n.forEach(o=>o(t))},V=(e,t,n)=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}),T=(e,t,n)=>{e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))},D=e=>t=>{t.preventDefault(),e(t)};function H(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,o,r,s,p=[],a="",b=e.split("/");for(b[0]||b.shift();r=b.shift();)n=r[0],n==="*"?(p.push("wild"),a+="/(.*)"):n===":"?(o=r.indexOf("?",1),s=r.indexOf(".",1),p.push(r.substring(1,~o?o:~s?s:r.length)),a+=!!~o&&!~s?"(?:/([^/]+?))?":"/([^/]+?)",~s&&(a+=(~o?"?":"")+"\\"+r.substring(s))):a+="/"+r;return{keys:p,pattern:new RegExp("^"+a+(t?"(?=$|/)":"/?$"),"i")}}const v=()=>new URL(window.location.href),E=(e,t=v())=>H(e).pattern.test(t.pathname);u(i.Init,()=>{let e=document.documentElement.getAttribute(i.Init);z(f,e)||(e=f.Display),T(document,h.Initialize),w(c.PageChange,t=>{E(t,v())||(history.pushState(null,"",t),L(c.ViewChange,e))}),V(window,"popstate",()=>{L(c.ViewChange,e)}),L(c.ViewChange,e),document.documentElement.removeAttribute(i.Init),T(document,h.Initialized)});const S=()=>{const e=document.querySelectorAll(W());return e.length===0?[]:Array.from(e,t=>{const n=Array.from(t.attributes),o=new Map;for(const{name:r,value:s}of n)P(r)&&o.set(r,s);return{content:t,directives:o}})},g=(e,t)=>e.filter(n=>n.directives.has(t)),k=(e,t)=>{e.forEach(({content:n})=>n.removeAttribute(t))},N=(e,t)=>{t?x(e):U(e)},x=({content:e})=>{e.style.display="revert"},U=({content:e})=>{e.style.display="none"},$=(e,t)=>{t?F(e):O(e)},F=e=>{const{content:t}=e;if(!C(t))return;const n=t.content.firstElementChild;n!=null&&(e.content.replaceWith(n),e.content=n)},O=e=>{const{content:t}=e;if(C(t))return;const n=document.createElement("template");n.content.append(t.cloneNode(!0)),e.content.replaceWith(n),e.content=n},j=(e,t)=>{e.content.classList.add(...t)},q=(e,t)=>{e.content.classList.remove(...t)};u(i.Cloak,e=>{const t=g(e,i.Cloak);t.length!==0&&k(t,i.Cloak)}),u(i.Link,e=>{const t=g(e,i.Link);if(t.length!==0){for(const n of t){const o=A(n);o!=null&&n.content.addEventListener("click",D(()=>{L(c.PageChange,o)}))}k(t,i.Link)}});const A=({content:e,directives:t})=>{var o;const n=t.get(i.Link);return m(n)?R(e)&&(o=e.pathname)!=null?o:null:n};u(i.LinkActive,e=>{const t=g(e,i.LinkActive);t.length!==0&&(w(c.ViewChange,()=>{const n=v();for(const o of t){const r=A(o);if(m(r))continue;let s=o.directives.get(i.LinkActive);m(s)&&(s="active"),E(r,n)?j(o,s.split(" ")):q(o,s.split(" "))}}),k(t,i.LinkActive))}),u(i.Page,e=>{const t=g(e,i.Page);t.length!==0&&(w(c.ViewChange,n=>{const o=v();for(const r of t){const s=r.directives.get(i.Page);if(!m(s))switch(n){case f.Display:N(r,E(s,o));break;case f.Template:$(r,E(s,o));break}}T(document,h.ViewChanged)}),k(t,i.Page))}),u(i.Title,e=>{const t=g(e,i.Title);if(t.length===0)return;const n=g(t,i.Page);if(n.length===0)return;const o=document.documentElement.getAttribute(i.Title);w(c.ViewChange,()=>{const r=v();for(const s of n){const p=s.directives.get(i.Page),a=s.directives.get(i.Title);if(!(m(p)||m(a))&&E(p,r)){o!=null?document.title=o.replace("{title}",a):document.title=a;break}}}),k(t,i.Title)}),(()=>{if(!document.documentElement.hasAttribute(i.Init))throw new Error(`Router cannot be initialized. Add '${i.Init}' attribute to <html></html> tag.`);const t=S();if(t.length===0)throw new Error("Router cannot be initialized. No directive found.");I(t,[i.Cloak,i.Title,i.Page,i.Link,i.LinkActive,i.Init])})()});
