(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";var n;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.Link="data-router-link",e.Page="data-router-page"})(n||(n={}));const E=new Map,u=(e,t)=>{E.set(e,t)},d=e=>{const t=E.get(e);t!=null&&t()},k=e=>C().includes(e),C=()=>Array.from(E.keys()),y=e=>T(e)?e.length==0:e==null,T=e=>typeof e=="string",L=(e,t)=>Object.values(e).includes(t),v=e=>e instanceof HTMLTemplateElement,A=e=>e instanceof HTMLAnchorElement;var c;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.PageChange="router:page-change",e.ViewChange="router:view-change",e.ViewChanged="router:view-changed"})(c||(c={}));const g=(e,t,i)=>(e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}),l=(e,t,i)=>{e.dispatchEvent(new CustomEvent(t,{detail:i,bubbles:!0,composed:!0,cancelable:!0}))};var s;(function(e){e.Display="display",e.Template="template"})(s||(s={}));const I=()=>Object.values(s);function z(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var i,r,o,a,m=[],f="",b=e.split("/");for(b[0]||b.shift();o=b.shift();)i=o[0],i==="*"?(m.push("wild"),f+="/(.*)"):i===":"?(r=o.indexOf("?",1),a=o.indexOf(".",1),m.push(o.substring(1,~r?r:~a?a:o.length)),f+=!!~r&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(f+=(~r?"?":"")+"\\"+o.substring(a))):f+="/"+o;return{keys:m,pattern:new RegExp("^"+f+(t?"(?=$|/)":"/?$"),"i")}}const p=()=>new URL(window.location.href),h=(e,t=p())=>z(e).pattern.test(t.pathname);u(n.Init,()=>{let e=document.documentElement.getAttribute(n.Init);(y(e)||!L(s,e))&&(e=s.Display,console.warn(`Setting default router mode: ${e}. Available modes: ${I().join(", ")}.`)),l(document,c.Initialize),g(document,c.PageChange,t=>{const{detail:i}=t;h(i,p())||(history.pushState(null,"",i),l(document,c.ViewChange,e))}),g(window,"popstate",()=>{l(document,c.ViewChange,e)}),l(document,c.ViewChange,e),l(document,c.Initialized)});const w=e=>{const t=document.querySelectorAll(`[${e}]`);return t.length===0?[]:Array.from(t,i=>{const r=Array.from(i.attributes),o=new Map;for(const{name:a,value:m}of r)k(a)&&o.set(a,m);return{content:i,directives:o}})},M=(e,t)=>{e?P(t):V(t)},P=({content:e})=>{e.style.display="initial"},V=({content:e})=>{e.style.display="none"},D=(e,t)=>{e?W(t):H(t)},W=e=>{const{content:t}=e;if(!v(t))return;const i=t.content.firstElementChild;i!=null&&(e.content.replaceWith(i),e.content=i)},H=e=>{const{content:t,directives:i}=e;if(v(t))return;const r=document.createElement("template");r.content.append(t.cloneNode(!0)),i.forEach((o,a)=>{r.setAttribute(a,o)}),e.content.replaceWith(r),e.content=r};u(n.Cloak,()=>{const e=w(n.Cloak);if(e.length!==0)for(const t of e)t.content.removeAttribute(n.Cloak)}),u(n.Link,()=>{const e=w(n.Link);e.length!==0&&e.forEach(({content:t,directives:i})=>{let r=i.get(n.Link);y(r)&&A(t)&&(r=t.href),r!=null&&t.addEventListener("click",o=>{o.preventDefault(),l(document,c.PageChange,r)})})}),u(n.Page,()=>{const e=w(n.Page);e.length!==0&&g(document,c.ViewChange,t=>{const{detail:i}=t,r=p();for(const o of e){const a=o.directives.get(n.Page);if(a!=null)switch(i){case s.Display:M(h(a,r),o);break;case s.Template:D(h(a,r),o);break}}l(document,c.ViewChanged)})}),u(n.Title,()=>{const e=w(n.Title);if(e.length===0)return;const t=document.documentElement.getAttribute(n.Title);g(document,c.ViewChange,()=>{const i=p();for(const r of e){const o=r.directives.get(n.Page),a=r.directives.get(n.Title);if(!(o==null||a==null)&&h(o,i)){t!=null?document.title=t.replace("{title}",a):document.title=a;break}}})}),(()=>{if(!document.documentElement.hasAttribute(n.Init))return console.warn(`Router cannot be initialized. Add '${n.Init}' attribute to <html></html> tag.`);d(n.Cloak),d(n.Title),d(n.Page),d(n.Link),d(n.Init)})()});
