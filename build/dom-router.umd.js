(function(m){typeof define=="function"&&define.amd?define(m):m()})(function(){"use strict";const m=new Map,f=(e,t)=>{m.set(e,t)},I=(e,t)=>{for(const n of t){const o=m.get(n);o!=null&&o(e)}},F=e=>T().includes(e),T=()=>Array.from(m.keys()),M=()=>T().map(e=>`[${e}]`).join(", "),V=e=>typeof e=="string",d=e=>e==null||V(e)&&e.length===0,z=(e,t)=>Object.values(e).includes(t),y=e=>e instanceof HTMLTemplateElement,D=e=>e instanceof HTMLAnchorElement;var i;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page",e.PageFallback="data-router-page-fallback"})(i||(i={}));var c;(function(e){e.PageChange="page-change",e.ViewChange="view-change"})(c||(c={}));var k;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.ViewChanged="router:view-changed"})(k||(k={}));var u;(function(e){e.Display="display",e.Template="template"})(u||(u={}));const h=new Map,b=(e,t)=>(h.has(e)||h.set(e,new Set),h.get(e).add(t),()=>{h.has(e)&&h.get(e).delete(t)}),v=(e,t)=>{var n;(n=h.get(e))==null||n.forEach(o=>o(t))},R=(e,t,n)=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)}),w=(e,t,n)=>{e.dispatchEvent(new CustomEvent(t,{detail:n,bubbles:!0,composed:!0,cancelable:!0}))},H=e=>t=>{t.preventDefault(),e(t)};function S(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,o,r,a,s=[],l="",L=e.split("/");for(L[0]||L.shift();r=L.shift();)n=r[0],n==="*"?(s.push("wild"),l+="/(.*)"):n===":"?(o=r.indexOf("?",1),a=r.indexOf(".",1),s.push(r.substring(1,~o?o:~a?a:r.length)),l+=!!~o&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(l+=(~o?"?":"")+"\\"+r.substring(a))):l+="/"+r;return{keys:s,pattern:new RegExp("^"+l+(t?"(?=$|/)":"/?$"),"i")}}const C=()=>new URL(window.location.href),E=(e,t=C())=>S(e).pattern.test(t.pathname);f(i.Init,()=>{let e=document.documentElement.getAttribute(i.Init);z(u,e)||(e=u.Display),w(document,k.Initialize),b(c.PageChange,t=>{E(t,C())||(history.pushState(null,"",t),v(c.ViewChange,e))}),R(window,"popstate",()=>{v(c.ViewChange,e)}),v(c.ViewChange,e),document.documentElement.removeAttribute(i.Init),w(document,k.Initialized)});const N=()=>{const e=document.querySelectorAll(M());return e.length===0?[]:Array.from(e,t=>{const n=Array.from(t.attributes),o=new Map;for(const{name:r,value:a}of n)F(r)&&o.set(r,a);return{content:t,directives:o}})},g=(e,t)=>e.filter(n=>n.directives.has(t)),x=(e,t)=>{var n;return(n=g(e,t)[0])!=null?n:null},p=(e,t)=>{e.forEach(({content:n})=>n.removeAttribute(t))},A=(e,t)=>{t?U(e):$(e)},U=({content:e})=>{e.style.display="revert"},$=({content:e})=>{e.style.display="none"},P=(e,t)=>{t?O(e):j(e)},O=e=>{const{content:t}=e;if(!y(t))return;const n=t.content.firstElementChild;n!=null&&(e.content.replaceWith(n),e.content=n)},j=e=>{const{content:t}=e;if(y(t))return;const n=document.createElement("template");n.content.append(t.cloneNode(!0)),e.content.replaceWith(n),e.content=n},B=(e,t)=>{e.content.classList.add(...t)},q=(e,t)=>{e.content.classList.remove(...t)};f(i.Cloak,e=>{const t=g(e,i.Cloak);t.length!==0&&p(t,i.Cloak)}),f(i.Link,e=>{const t=g(e,i.Link);if(t.length!==0){for(const n of t){const o=W(n);o!=null&&n.content.addEventListener("click",H(()=>{v(c.PageChange,o)}))}p(t,i.Link)}});const W=({content:e,directives:t})=>{var o;const n=t.get(i.Link);return d(n)?D(e)&&(o=e.pathname)!=null?o:null:n};f(i.LinkActive,e=>{const t=g(e,i.LinkActive);t.length!==0&&(b(c.ViewChange,()=>{for(const n of t){const o=W(n);if(d(o))continue;let r=n.directives.get(i.LinkActive);d(r)&&(r="active"),E(o)?B(n,r.split(" ")):q(n,r.split(" "))}}),p(t,i.LinkActive))}),f(i.Page,e=>{const t=g(e,i.Page);if(t.length===0)return;console.log({elementsWithPage:t});const n=x(t,i.PageFallback);console.log({elementWithFallback:n}),b(c.ViewChange,o=>{let r=!1;for(const a of t){const s=a.directives.get(i.Page);if(d(s))continue;const l=E(s);switch(o){case u.Display:A(a,l);break;case u.Template:P(a,l);break}r||(r=l)}if(!r&&n!=null)switch(o){case u.Display:A(n,!0);break;case u.Template:P(n,!0);break}w(document,k.ViewChanged)}),p(t,i.Page)}),f(i.PageFallback,e=>{const t=g(e,i.PageFallback);t.length!==0&&p(t,i.PageFallback)}),f(i.Title,e=>{const t=g(e,i.Title);if(t.length===0)return;const n=g(t,i.Page);if(n.length===0)return;const o=document.documentElement.getAttribute(i.Title);b(c.ViewChange,()=>{for(const r of n){const a=r.directives.get(i.Page),s=r.directives.get(i.Title);if(!(d(a)||d(s))&&E(a)){o!=null?document.title=o.replace("{title}",s):document.title=s;break}}}),p(t,i.Title)}),(()=>{if(!document.documentElement.hasAttribute(i.Init))throw new Error(`Router cannot be initialized. Add '${i.Init}' attribute to <html></html> tag.`);const t=N();if(t.length===0)throw new Error("Router cannot be initialized. No directive found.");I(t,[i.Cloak,i.Title,i.Page,i.PageFallback,i.Link,i.LinkActive,i.Init])})()});
