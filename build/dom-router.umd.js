(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";var n;(function(e){e.Init="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.Link="data-router-link",e.Page="data-router-page"})(n||(n={}));const b=new Map,u=(e,t)=>{b.set(e,t)},d=e=>{const t=b.get(e);t!=null&&t()},L=e=>A().includes(e),A=()=>Array.from(b.keys()),k=e=>I(e)?e.length==0:e==null,I=e=>typeof e=="string",M=(e,t)=>Object.values(e).includes(t),C=e=>e instanceof HTMLTemplateElement,z=e=>e instanceof HTMLAnchorElement;var a;(function(e){e.PageChange="page-change",e.ViewChange="view-change"})(a||(a={}));var f;(function(e){e.Initialize="router:initialize",e.Initialized="router:initialized",e.ViewChanged="router:view-changed"})(f||(f={}));const l=new Map,y=(e,t)=>(l.has(e)||l.set(e,new Set),l.get(e).add(t),()=>{l.has(e)&&l.get(e).delete(t)}),p=(e,t)=>{var i;(i=l.get(e))==null||i.forEach(r=>{r(t)})},P=(e,t,i)=>(e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}),v=(e,t,i)=>{e.dispatchEvent(new CustomEvent(t,{detail:i,bubbles:!0,composed:!0,cancelable:!0}))};var c;(function(e){e.Display="display",e.Template="template"})(c||(c={}));const V=()=>Object.values(c);function D(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var i,r,o,s,g=[],m="",T=e.split("/");for(T[0]||T.shift();o=T.shift();)i=o[0],i==="*"?(g.push("wild"),m+="/(.*)"):i===":"?(r=o.indexOf("?",1),s=o.indexOf(".",1),g.push(o.substring(1,~r?r:~s?s:o.length)),m+=!!~r&&!~s?"(?:/([^/]+?))?":"/([^/]+?)",~s&&(m+=(~r?"?":"")+"\\"+o.substring(s))):m+="/"+o;return{keys:g,pattern:new RegExp("^"+m+(t?"(?=$|/)":"/?$"),"i")}}const h=()=>new URL(window.location.href),E=(e,t=h())=>D(e).pattern.test(t.pathname);u(n.Init,()=>{let e=document.documentElement.getAttribute(n.Init);(k(e)||!M(c,e))&&(e=c.Display,console.warn(`Setting default router mode: ${e}. Available modes: ${V().join(", ")}.`)),v(document,f.Initialize),y(a.PageChange,t=>{E(t,h())||(history.pushState(null,"",t),p(a.ViewChange,e))}),P(window,"popstate",()=>{p(a.ViewChange,e)}),p(a.ViewChange,e),v(document,f.Initialized)});const w=e=>{const t=document.querySelectorAll(`[${e}]`);return t.length===0?[]:Array.from(t,i=>{const r=Array.from(i.attributes),o=new Map;for(const{name:s,value:g}of r)L(s)&&o.set(s,g);return{content:i,directives:o}})},W=(e,t)=>{e?H(t):R(t)},H=({content:e})=>{e.style.display="revert"},R=({content:e})=>{e.style.display="none"},S=(e,t)=>{e?$(t):x(t)},$=e=>{const{content:t}=e;if(!C(t))return;const i=t.content.firstElementChild;i!=null&&(e.content.replaceWith(i),e.content=i)},x=e=>{const{content:t,directives:i}=e;if(C(t))return;const r=document.createElement("template");r.content.append(t.cloneNode(!0)),i.forEach((o,s)=>{r.setAttribute(s,o)}),e.content.replaceWith(r),e.content=r};u(n.Cloak,()=>{const e=w(n.Cloak);if(e.length!==0)for(const t of e)t.content.removeAttribute(n.Cloak)}),u(n.Link,()=>{const e=w(n.Link);e.length!==0&&e.forEach(({content:t,directives:i})=>{let r=i.get(n.Link);k(r)&&z(t)&&(r=t.href),r!=null&&t.addEventListener("click",o=>{o.preventDefault(),p(a.PageChange,r)})})}),u(n.Page,()=>{const e=w(n.Page);e.length!==0&&y(a.ViewChange,t=>{const i=h();for(const r of e){const o=r.directives.get(n.Page);if(o!=null)switch(t){case c.Display:W(E(o,i),r);break;case c.Template:S(E(o,i),r);break}}v(document,f.ViewChanged)})}),u(n.Title,()=>{const e=w(n.Title);if(e.length===0)return;const t=document.documentElement.getAttribute(n.Title);y(a.ViewChange,()=>{const i=h();for(const r of e){const o=r.directives.get(n.Page),s=r.directives.get(n.Title);if(!(o==null||s==null)&&E(o,i)){t!=null?document.title=t.replace("{title}",s):document.title=s;break}}})}),(()=>{if(!document.documentElement.hasAttribute(n.Init))return console.warn(`Router cannot be initialized. Add '${n.Init}' attribute to <html></html> tag.`);d(n.Cloak),d(n.Title),d(n.Page),d(n.Link),d(n.Init)})()});
