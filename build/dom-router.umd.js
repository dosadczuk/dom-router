(function(n){typeof define=="function"&&define.amd?define(n):n()})(function(){"use strict";var n;(function(t){t.Init="data-router",t.Cloak="data-router-cloak",t.Title="data-router-title",t.Link="data-router-link",t.Page="data-router-page"})(n||(n={}));const p=new Map,u=(t,e)=>{p.set(t,e)},l=t=>{const e=p.get(t);e!=null&&e()},L=t=>b().includes(t),b=()=>Array.from(p.keys());var a;(function(t){t.Initialize="router:initialize",t.Initialized="router:initialized",t.PageChange="router:page-change",t.PageChanged="router:page-changed",t.ViewChanged="router:view-changed"})(a||(a={}));const g=(t,e,i)=>(t.addEventListener(e,i),()=>{t.removeEventListener(e,i)}),s=(t,e,i)=>{t.dispatchEvent(new CustomEvent(e,{detail:i,bubbles:!0,composed:!0,cancelable:!0}))};function T(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var i,r,o,c,d=[],f="",k=t.split("/");for(k[0]||k.shift();o=k.shift();)i=o[0],i==="*"?(d.push("wild"),f+="/(.*)"):i===":"?(r=o.indexOf("?",1),c=o.indexOf(".",1),d.push(o.substring(1,~r?r:~c?c:o.length)),f+=!!~r&&!~c?"(?:/([^/]+?))?":"/([^/]+?)",~c&&(f+=(~r?"?":"")+"\\"+o.substring(c))):f+="/"+o;return{keys:d,pattern:new RegExp("^"+f+(e?"(?=$|/)":"/?$"),"i")}}const h=()=>new URL(window.location.href),C=(t,e=h())=>T(t).pattern.test(e.pathname);u(n.Init,()=>{s(document,a.Initialize),g(document,a.PageChange,t=>{const{detail:e}=t;C(e,h())||(history.pushState(null,"",e),s(document,a.PageChanged))}),g(window,"popstate",()=>{s(document,a.PageChanged)}),s(document,a.PageChanged),s(document,a.Initialized)});const v=t=>w(t)?t.length==0:t==null,w=t=>typeof t=="string",E=t=>t instanceof HTMLTemplateElement,P=t=>t instanceof HTMLAnchorElement,m=t=>{const e=document.querySelectorAll(`[${t}]`);return e.length===0?[]:Array.from(e,i=>{const r=Array.from(i.attributes),o=new Map;for(const{name:c,value:d}of r)L(c)&&o.set(c,d);return{content:i,directives:o}})},y=t=>{const{content:e}=t;if(!E(e))return;const i=e.content.firstElementChild;i!=null&&(t.content.replaceWith(i),t.content=i)},A=t=>{const{content:e,directives:i}=t;if(E(e))return;const r=document.createElement("template");r.content.append(e.cloneNode(!0)),i.forEach((o,c)=>{r.setAttribute(c,o)}),t.content.replaceWith(r),t.content=r};u(n.Cloak,()=>{const t=m(n.Cloak);if(t.length!==0)for(const e of t)e.content.removeAttribute(n.Cloak)}),u(n.Link,()=>{const t=m(n.Link);t.length!==0&&t.forEach(({content:e,directives:i})=>{let r=i.get(n.Link);v(r)&&P(e)&&(r=e.href),r!=null&&e.addEventListener("click",o=>{o.preventDefault(),s(document,a.PageChange,r)})})}),u(n.Page,()=>{const t=m(n.Page);t.length!==0&&g(document,a.PageChanged,()=>{const e=h();for(const i of t){const r=i.directives.get(n.Page);r!=null&&(C(r,e)?y(i):A(i))}s(document,a.ViewChanged)})}),u(n.Title,()=>{const t=m(n.Title);if(t.length===0)return;const e=document.documentElement.getAttribute(n.Title);g(document,a.PageChanged,()=>{const i=h();for(const r of t){const o=r.directives.get(n.Page),c=r.directives.get(n.Title);if(!(o==null||c==null)&&C(o,i)){e!=null?document.title=e.replace("{title}",c):document.title=c;break}}})}),(()=>{if(!document.documentElement.hasAttribute(n.Init))return console.warn(`Router cannot be initialized. Add '${n.Init}' attribute to <html></html> tag.`);l(n.Cloak),l(n.Title),l(n.Page),l(n.Link),l(n.Init)})()});
