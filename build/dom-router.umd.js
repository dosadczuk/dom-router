(function(h){typeof define=="function"&&define.amd?define(h):h()})(function(){"use strict";const h=e=>typeof e=="string"||e instanceof String,m=e=>e==null||h(e)&&e.length===0,C=(e,t)=>Object.values(t).includes(String(e)),V=e=>C(e,r)&&R().includes(e),U=e=>e instanceof HTMLAnchorElement,D=e=>e instanceof HTMLTemplateElement;var T=(e=>(e.Display="display",e.Template="template",e))(T||{});let I=document.body;const z=(e,t)=>{var n;return(n=document.documentElement.getAttribute(String(e)))!=null?n:t},F=e=>e.map(t=>z(t)),B=e=>document.documentElement.hasAttribute(String(e)),H=e=>{document.documentElement.removeAttribute(String(e))},W=e=>{e.forEach(t=>H(t))},N=()=>{const e=I.querySelectorAll(Q());return e.length===0?[]:Array.from(e,t=>{const n=Array.from(t.attributes),o=new Map;for(const{name:i,value:a}of n)V(i)&&o.set(i,a);return{element:t,visible:!1,directives:o}})},A=(e,t)=>{var n;return(n=e.find(o=>o.directives.has(t)))!=null?n:null},$=(e,t)=>{e.forEach(({element:n})=>{n.removeAttribute(t)})},L=e=>(t,n)=>{switch(e){case"display":return n?O(t):j(t);case"template":return n?q(t):x(t)}return t.visible},O=e=>(e.element.style.display="revert",e.visible=!0,!0),j=e=>(e.element.style.display="none",e.visible=!1,!1),q=e=>{const{element:t}=e;if(!D(t))return!0;const n=t.content.firstElementChild;return n==null?!1:(e.element.replaceWith(n),e.element=n,e.visible=!0,!0)},x=e=>{const{element:t}=e;if(D(t))return!1;const n=document.createElement("template");return n.content.append(t.cloneNode(!0)),e.element.replaceWith(n),e.element=n,e.visible=!1,!1},G=(e,t)=>{e.element.classList.add(...t)},J=(e,t)=>{e.element.classList.remove(...t)};var r=(e=>(e.Initialize="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.TitleDefault="data-router-title-default",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page",e.PageFallback="data-router-page-fallback",e.Sitemap="data-router-sitemap",e.SitemapIgnore="data-router-sitemap-ignore",e))(r||{});const S=new Map,c=(e,t)=>{S.set(e,t!=null?t:null)},K=(e,t)=>{for(const n of t){const o=S.get(n);if(o==null)continue;const{factory:i,options:a}=o;if(i!=null){const s=i(e,a);s!=null&&s()}a!=null&&a.removable&&$(e,n)}},R=()=>Array.from(S.keys()),Q=()=>R().map(e=>`[${e}]`).join(", ");var u=(e=>(e[e.PageChange=0]="PageChange",e[e.ViewChange=1]="ViewChange",e))(u||{}),f=(e=>(e.BeforeMount="router:before-mount",e.Mounted="router:mounted",e.BeforePageUpdate="router:before-page-update",e.PageUpdated="router:page-updated",e.BeforeViewUpdate="router:before-view-update",e.ViewUpdated="router:view-updated",e))(f||{});const g=new Map,b=(e,t)=>(g.has(e)||g.set(e,new Set),g.get(e).add(t),()=>{g.get(e).delete(t)}),v=(e,t)=>{var n;(n=g.get(e))==null||n.forEach(o=>o(t))},X=(e,t,n)=>(e.addEventListener(String(t),n),()=>{e.removeEventListener(String(t),n)}),p=(e,t,n)=>{e.dispatchEvent(new CustomEvent(String(t),{detail:n,bubbles:!0,composed:!0,cancelable:!0}))},Y=e=>t=>{t.preventDefault(),t.stopPropagation(),e(t)};function Z(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,o,i,a,s=[],l="",d=e.split("/");for(d[0]||d.shift();i=d.shift();)n=i[0],n==="*"?(s.push("wild"),l+="/(.*)"):n===":"?(o=i.indexOf("?",1),a=i.indexOf(".",1),s.push(i.substring(1,~o?o:~a?a:i.length)),l+=!!~o&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(l+=(~o?"?":"")+"\\"+i.substring(a))):l+="/"+i;return{keys:s,pattern:new RegExp("^"+l+(t?"(?=$|/)":"/?$"),"i")}}const E=()=>new URL(window.location.href),y=(e,t=E())=>Z(e).pattern.test(t.pathname);c(r.Initialize,{factory:()=>{let e=z(r.Initialize,"");C(e,T)||(e=T.Display),p(document,f.BeforeMount),b(u.PageChange,t=>{y(t,E())||(p(document,f.BeforePageUpdate),history.pushState(null,"",t),p(document,f.PageUpdated),v(u.ViewChange,L(e)))}),X(window,"popstate",()=>{v(u.ViewChange,L(e))}),v(u.ViewChange,L(e)),p(document,f.Mounted)},options:{removable:!0}}),c(r.Cloak,{factory:null,options:{removable:!0}});const w=new Map,M=e=>{if(w.size>0)return w;for(const t of e){const n=_(t);m(n)||w.set(n,t)}return w},_=e=>{var o;const{element:t,directives:n}=e;return U(t)&&!m(t.href)?t.pathname:(o=n.get(r.Link))!=null?o:null};c(r.Link,{factory:e=>{const t=M(e);if(t.size!==0)for(const[n,o]of t)o.element.addEventListener("click",Y(()=>{v(u.PageChange,n)}))},options:{removable:!0}}),c(r.LinkActive,{factory:e=>{const t=M(e);t.size!==0&&b(u.ViewChange,()=>{for(const[n,o]of t){let i=o.directives.get(r.LinkActive);m(i)&&(i="active"),y(n)?G(o,i.split(" ")):J(o,i.split(" "))}})},options:{removable:!0}});const k=new Map,P=e=>{if(k.size>0)return k;for(const t of e){const n=t.directives.get(r.Page);m(n)||k.set(n,t)}return k};c(r.Page,{factory:e=>{const t=P(e);if(t.size===0)return;const n=A(e,r.PageFallback);b(u.ViewChange,o=>{const i={route:null,element:null};p(document,f.BeforeViewUpdate);for(const[a,s]of t)o(s,y(a))&&(i.route=a,i.element=s.element);i.element==null&&n!=null&&o(n,!0)&&(i.element=n.element),p(document,f.ViewUpdated,i)})},options:{removable:!0}}),c(r.PageFallback,{factory:null,options:{removable:!0}}),c(r.Sitemap,{factory:e=>{const t=A(e,r.Sitemap);if(t==null)return;const n=P(e);if(n.size===0)return;const o=document.createElement("ol");for(const[i,{directives:a}]of n){if(a.has(r.SitemapIgnore))continue;const s=a.get(r.Title);if(m(s))continue;const l=document.createElement("a");l.href=i,l.text=s;const d=document.createElement("li");d.append(l),o.append(d)}t.element.append(o)},options:{removable:!1}}),c(r.SitemapIgnore,{factory:null,options:{removable:!0}}),c(r.Title,{factory:e=>{const t=P(e);if(t.size===0)return;const[n,o]=F([r.Title,r.TitleDefault]);return b(u.ViewChange,()=>{var i;for(const[a,s]of t){if(!y(a,E()))continue;const l=(i=s.directives.get(r.Title))!=null?i:o;if(!m(l)){n!=null?document.title=n.replace("{{title}}",l):document.title=l;break}}}),()=>{W([r.Title,r.TitleDefault])}},options:{removable:!0}}),c(r.TitleDefault,{factory:null,options:{removable:!0}});const ee=[r.Cloak,r.TitleDefault,r.Title,r.PageFallback,r.Page,r.SitemapIgnore,r.Sitemap,r.LinkActive,r.Link,r.Initialize];(function(){if(!B(r.Initialize))throw new Error(`Router cannot be initialized. Add '${r.Initialize}' attribute to root element.`);const n=N();if(n.length===0)throw new Error("Router cannot be initialized. No directive found.");K(n,ee)})()});
