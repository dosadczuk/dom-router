(function(b){typeof define=="function"&&define.amd?define(b):b()})(function(){"use strict";const b=e=>typeof e=="string"||e instanceof String,m=e=>e==null||b(e)&&e.length===0,P=(e,t)=>Object.values(t).includes(String(e)),M=e=>P(e,i)&&A().includes(e),V=e=>e instanceof HTMLAnchorElement,C=e=>e instanceof HTMLTemplateElement;var y=(e=>(e.Display="display",e.Template="template",e))(y||{});let U=document.body;const D=(e,t)=>{var n;return(n=document.documentElement.getAttribute(String(e)))!=null?n:t},I=e=>e.map(t=>D(t)),F=e=>document.documentElement.hasAttribute(String(e)),B=e=>{document.documentElement.removeAttribute(String(e))},H=e=>{e.forEach(t=>B(t))},W=()=>{const e=U.querySelectorAll(K());return e.length===0?[]:Array.from(e,t=>{const n=Array.from(t.attributes),r=new Map;for(const{name:o,value:a}of n)M(o)&&r.set(o,a);return{element:t,visible:!1,directives:r}})},z=(e,t)=>{var n;return(n=e.find(r=>r.directives.has(t)))!=null?n:null},N=(e,t)=>{e.forEach(({element:n})=>{n.removeAttribute(t)})},S=e=>(t,n)=>{switch(e){case"display":return n?$(t):O(t);case"template":return n?j(t):q(t)}return t.visible},$=e=>(e.element.style.display="revert",e.visible=!0,!0),O=e=>(e.element.style.display="none",e.visible=!1,!1),j=e=>{const{element:t}=e;if(!C(t))return!0;const n=t.content.firstElementChild;return n==null?!1:(e.element.replaceWith(n),e.element=n,e.visible=!0,!0)},q=e=>{const{element:t}=e;if(C(t))return!1;const n=document.createElement("template");return n.content.append(t.cloneNode(!0)),e.element.replaceWith(n),e.element=n,e.visible=!1,!1},x=(e,t)=>{e.element.classList.add(...t)},G=(e,t)=>{e.element.classList.remove(...t)};var i=(e=>(e.Initialize="data-router",e.Cloak="data-router-cloak",e.Title="data-router-title",e.TitleDefault="data-router-title-default",e.Link="data-router-link",e.LinkActive="data-router-link-active",e.Page="data-router-page",e.PageFallback="data-router-page-fallback",e.Sitemap="data-router-sitemap",e.SitemapIgnore="data-router-sitemap-ignore",e))(i||{});const L=new Map,c=(e,t)=>{L.set(e,t)},J=(e,t)=>{for(const n of t){const r=L.get(n);if(r==null)continue;const{factory:o,options:a}=r;if(o!=null){const s=o(e);s!=null&&s()}a!=null&&a.removable&&N(e,n)}},A=()=>Array.from(L.keys()),K=()=>A().map(e=>`[${e}]`).join(", ");var u=(e=>(e[e.PageChange=0]="PageChange",e[e.ViewChange=1]="ViewChange",e))(u||{}),f=(e=>(e.BeforeMount="router:before-mount",e.Mounted="router:mounted",e.BeforePageUpdate="router:before-page-update",e.PageUpdated="router:page-updated",e.BeforeViewUpdate="router:before-view-update",e.ViewUpdated="router:view-updated",e))(f||{});const h=new Map,v=(e,t)=>(h.has(e)||h.set(e,new Set),h.get(e).add(t),()=>{h.get(e).delete(t)}),k=(e,t)=>{var n;(n=h.get(e))==null||n.forEach(r=>r(t))},Q=(e,t,n)=>(e.addEventListener(String(t),n),()=>{e.removeEventListener(String(t),n)}),d=(e,t,n)=>{e.dispatchEvent(new CustomEvent(String(t),{detail:n,bubbles:!0,composed:!0,cancelable:!0}))},X=e=>t=>{t.preventDefault(),e(t)};function Y(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var n,r,o,a,s=[],l="",g=e.split("/");for(g[0]||g.shift();o=g.shift();)n=o[0],n==="*"?(s.push("wild"),l+="/(.*)"):n===":"?(r=o.indexOf("?",1),a=o.indexOf(".",1),s.push(o.substring(1,~r?r:~a?a:o.length)),l+=!!~r&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(l+=(~r?"?":"")+"\\"+o.substring(a))):l+="/"+o;return{keys:s,pattern:new RegExp("^"+l+(t?"(?=$|/)":"/?$"),"i")}}const Z=()=>new URL(window.location.href),w=(e,t=Z())=>Y(e).pattern.test(t.pathname);c(i.Initialize,{factory:()=>{let e=D(i.Initialize,"");P(e,y)||(e=y.Display),d(document,f.BeforeMount),v(u.PageChange,t=>{w(t)||(d(document,f.BeforePageUpdate),history.pushState(null,"",t),d(document,f.PageUpdated,t),k(u.ViewChange,S(e)))}),Q(window,"popstate",()=>{k(u.ViewChange,S(e))}),k(u.ViewChange,S(e)),d(document,f.Mounted)},options:{removable:!0}}),c(i.Cloak,{options:{removable:!0}});const p=new Map,R=e=>{if(p.size>0)return p;for(const t of e){const n=_(t);m(n)||(p.has(n)||p.set(n,new Set),p.get(n).add(t))}return p},_=e=>{var r;const{element:t,directives:n}=e;return V(t)&&!m(t.href)?t.pathname:(r=n.get(i.Link))!=null?r:null};c(i.Link,{factory:e=>{const t=R(e);if(t.size!==0)for(const[n,r]of t)for(const{element:o}of r)o.addEventListener("click",X(()=>{k(u.PageChange,n)}))},options:{removable:!0}}),c(i.LinkActive,{factory:e=>{const t=R(e);t.size!==0&&v(u.ViewChange,()=>{for(const[n,r]of t)for(const o of r){let a=o.directives.get(i.LinkActive);m(a)&&(a="active"),w(n)?x(o,a.split(" ")):G(o,a.split(" "))}})},options:{removable:!0}});const T=new Map,E=e=>{if(T.size>0)return T;for(const t of e){const n=t.directives.get(i.Page);m(n)||T.set(n,t)}return T};c(i.Page,{factory:e=>{const t=E(e);if(t.size===0)return;const n=z(e,i.PageFallback);v(u.ViewChange,r=>{const o={route:null,element:null};d(document,f.BeforeViewUpdate);for(const[a,s]of t)r(s,w(a))&&(o.route=a,o.element=s.element);o.element==null&&n!=null&&r(n,!0)&&(o.element=n.element),d(document,f.ViewUpdated,o)})},options:{removable:!0}}),c(i.PageFallback,{options:{removable:!0}}),c(i.Sitemap,{factory:e=>{const t=z(e,i.Sitemap);if(t==null)return;const n=E(e);if(n.size===0)return;const r=document.createElement("ol");for(const[o,{directives:a}]of n){if(a.has(i.SitemapIgnore))continue;const s=a.get(i.Title);if(m(s))continue;const l=document.createElement("a");l.href=o,l.text=s;const g=document.createElement("li");g.append(l),r.append(g)}t.element.append(r)},options:{removable:!1}}),c(i.SitemapIgnore,{options:{removable:!0}}),c(i.Title,{factory:e=>{const t=E(e);if(t.size===0)return;const[n,r]=I([i.Title,i.TitleDefault]);return v(u.ViewChange,()=>{var o;for(const[a,s]of t){if(!w(a))continue;const l=(o=s.directives.get(i.Title))!=null?o:r;if(!m(l)){n!=null?document.title=n.replace("{{title}}",l):document.title=l;break}}}),()=>{H([i.Title,i.TitleDefault])}},options:{removable:!0}}),c(i.TitleDefault,{options:{removable:!0}});const ee=[i.Cloak,i.TitleDefault,i.Title,i.PageFallback,i.Page,i.SitemapIgnore,i.Sitemap,i.LinkActive,i.Link,i.Initialize];(function(){if(!F(i.Initialize))throw new Error(`Router cannot be initialized. Add '${i.Initialize}' attribute to root element.`);const n=W();if(n.length===0)throw new Error("Router cannot be initialized. No directive found.");J(n,ee)})()});
